#!/usr/bin/bash

# status percent number (less equal than)
percent_crit=10
percent_low=25
percent_avg=55
percent_good=75

# colors
color_crit="#FF0000"
color_low="#FFA500"
color_avg="#FFFF00"
color_good=""		#I dont like to color this
color_full="#00FF00"

# icons for the label (FontAwesome)
bat_crit=""
bat_low=""
bat_avg=""
bat_good=""
bat_full=""
charging=""
loading=""

# main command (acpi)
output=$(acpi -b)

# get current battery percentual charge
percent=$(echo "$output" | cut -d " " -f4 | tr -d ,%)

#get current estimated time for charging|discharging
estimated_time() {
	_time="$(echo $output | cut -d " " -f5 | cut -c1-5 | tr -d a-zA-Z )"
	if [[ -n $_time ]]; then
		_hour=$(echo $_time | cut -c1-2)
		_minutes=$(echo $_time | cut -c4-5)
		if [[ $_hour -eq 0 ]];then
			_hour=""
			_minutes="${_minutes}m"
		else
			_hour="${_hour}h"
			_minutes="${_minutes}"
		fi
		_time="($_hour$_minutes)"
	fi
	echo $_time;
}

if [[ -n $(echo $output | grep Charging) ]]; then
	label=$charging
	estimated=`estimated_time`
	if [[ $percent -eq 100 ]]; then
		color=$color_full
	fi
else
	if [[ -n $(echo $output | grep Unknown) ]]; then
		# disabled due to acpi reporting Unknown behavior in some actually known momments
		color=$color_full
		label=$charging
	elif [[ -n $(echo $output | grep Full) ]]; then
		color=$color_full
		label=$charging
	elif [[ $percent -le $percent_crit ]]; then
		color=$color_crit
		label=$bat_crit
	elif [[ $percent -le $percent_low ]]; then
		color=$color_low
		label=$bat_low
	elif [[ $percent -le $percent_avg ]]; then
		color=$color_avg
		label=$bat_avg
	elif [[ $percent -le $percent_good ]]; then
		color=$color_good
		label=$bat_good
	else
		#color=$color_full
		label=$bat_full
	fi

	if [[ -n $(echo $output | grep Discharging) ]]; then
		estimated=`estimated_time`
	fi
fi


echo "$label $percent% $estimated"	# full text
echo "$label $percent%"			# short text
echo "$color"				# display color
